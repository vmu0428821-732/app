<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Ä–∞–≤–Ω–µ–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0d6efd;
            margin-bottom: 30px;
        }
        .btn-primary {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
        }
        .animation-container {
            margin-top: 30px;
            text-align: center;
        }
        .animation-container img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .info-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .parameters-group {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .parameters-group h3 {
            color: #0d6efd;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            font-weight: bold;
            font-size: 1.1em;
        }
        .form-control {
            font-size: 1.1em;
            padding: 8px;
        }
        .animation-controls {
            margin-bottom: 20px;
        }
        .animation-controls .btn {
            font-size: 1.1em;
            padding: 8px 20px;
        }
        #animationCanvas {
            width: 100%;
            height: 600px;
            margin: 20px 0;
        }
        .axis-label {
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">
            {% if eq_name == 'heat' %}
            –£—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç–∏
            {% elif eq_name == 'wave' %}
            –í–æ–ª–Ω–æ–≤–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ
            {% elif eq_name == 'advection' %}
            –£—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞
            {% endif %}
        </h1>
        <form method="POST">
            <input type="hidden" name="eq_name" value="{{ eq_name }}">
            
            <div class="parameters-group">
                <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="x_start">–ù–∞—á–∞–ª–æ –æ—Ç—Ä–µ–∑–∫–∞ –ø–æ –æ—Å–∏ x:</label>
                            <input type="number" class="form-control" id="x_start" name="x_start" step="0.1" value="{{ params.x_start if params.x_start is defined else 0 }}" required>
                            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –æ—Ç—Ä–µ–∑–∫–∞</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="x_end">–ö–æ–Ω–µ—Ü –æ—Ç—Ä–µ–∑–∫–∞ –ø–æ –æ—Å–∏ x:</label>
                            <input type="number" class="form-control" id="x_end" name="x_end" step="0.1" value="{{ params.x_end if params.x_end is defined else 10 }}" required>
                            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –æ—Ç—Ä–µ–∑–∫–∞</small>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="t_end">–ö–æ–Ω–µ—á–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏:</label>
                            <input type="number" class="form-control" id="t_end" name="t_end" step="0.1" min="0.1" value="{{ params.t_end if params.t_end is defined else 1.0 }}" required>
                            <small class="form-text text-muted">–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω–µ—á–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        {% if eq_name == 'heat' %}
                        <div class="form-group">
                            <label for="k">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–µ–ø–ª–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç–∏ k:</label>
                            <input type="number" class="form-control" id="k" name="k" step="0.1" min="0.1" max="1.0" value="{{ params.k if params.k is defined else '0.5' }}" required>
                            <small class="form-text text-muted">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0 < k ‚â§ 1</small>
                        </div>
                        {% elif eq_name == 'wave' %}
                        <div class="form-group">
                            <label for="c">–°–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–Ω—ã c:</label>
                            <input type="number" class="form-control" id="c" name="c" step="0.1" min="0.1" value="{{ params.c if params.c is defined else '1.0' }}" required>
                            <small class="form-text text-muted">–õ—é–±–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</small>
                        </div>
                        {% elif eq_name == 'advection' %}
                        <div class="form-group">
                            <label for="v">–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞ v:</label>
                            <input type="number" class="form-control" id="v" name="v" step="0.1" min="0.1" value="{{ params.v if params.v is defined else '1.0' }}" required>
                            <small class="form-text text-muted">–õ—é–±–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</small>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="form-group">
                            <label for="initial_condition">–ù–∞—á–∞–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:</label>
                            {% if eq_name == 'heat' %}
                            <select class="form-control" id="initial_condition" name="initial_condition">
                                <option value="sin" {% if params.initial_condition == 'sin' %}selected{% endif %}>u‚ÇÄ(x) = sin(œÄx/L)</option>
                                <option value="gaussian" {% if params.initial_condition == 'gaussian' %}selected{% endif %}>u‚ÇÄ(x) = e^(-((x-x‚ÇÄ)¬≤)/2a)</option>
                                <option value="linear" {% if params.initial_condition == 'linear' %}selected{% endif %}>u‚ÇÄ(x) = kx + b</option>
                            </select>
                            <div id="gaussian_params" class="mt-2" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="x0" placeholder="x‚ÇÄ (—Ü–µ–Ω—Ç—Ä)" value="{{ params.x0 if params.x0 is defined else 5 }}" step="0.1">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="a" placeholder="a (—à–∏—Ä–∏–Ω–∞)" value="{{ params.a if params.a is defined else 1 }}" step="0.1" min="0.1">
                                    </div>
                                </div>
                            </div>
                            <div id="linear_params" class="mt-2" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="k_linear" placeholder="k (–Ω–∞–∫–ª–æ–Ω)" value="{{ params.k_linear if params.k_linear is defined else 1 }}" step="0.1">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="b" placeholder="b (—Å–º–µ—â–µ–Ω–∏–µ)" value="{{ params.b if params.b is defined else 0 }}" step="0.1">
                                    </div>
                                </div>
                            </div>
                            {% elif eq_name == 'wave' %}
                            <select class="form-control" id="initial_condition" name="initial_condition">
                                <option value="sin1">u‚ÇÄ(x) = sin(œÄx/L)</option>
                                <option value="sin2">u‚ÇÄ(x) = sin(2œÄx/L)</option>
                                <option value="sin3">u‚ÇÄ(x) = sin(3œÄx/L)</option>
                            </select>
                            {% elif eq_name == 'advection' %}
                            <select class="form-control" id="initial_condition" name="initial_condition">
                                <option value="step">–°—Ç—É–ø–µ–Ω—á–∞—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è</option>
                                <option value="gaussian">u‚ÇÄ(x) = e^(-((x-x‚ÇÄ)¬≤)/2a)</option>
                            </select>
                            <div id="gaussian_params" class="mt-2" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="x0" placeholder="x‚ÇÄ (—Ü–µ–Ω—Ç—Ä)" value="{{ params.x0 if params.x0 is defined else 5 }}" step="0.1">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" name="a" placeholder="a (—à–∏—Ä–∏–Ω–∞)" value="{{ params.a if params.a is defined else 1 }}" step="0.1" min="0.1">
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <small class="form-text text-muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="parameters-group">
                <h3>–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>–õ–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ (x = x_start):</label>
                            <select class="form-control mb-2" id="left_boundary_type" name="left_boundary_type">
                                <option value="dirichlet" {% if params.left_boundary_type == 'dirichlet' %}selected{% endif %}>–£—Å–ª–æ–≤–∏–µ –î–∏—Ä–∏—Ö–ª–µ (u = const)</option>
                                <option value="neumann" {% if params.left_boundary_type == 'neumann' %}selected{% endif %}>–£—Å–ª–æ–≤–∏–µ –ù–µ–π–º–∞–Ω–∞ (du/dx = const)</option>
                            </select>
                            <div class="input-group">
                                <input type="number" class="form-control" id="left_boundary_value" name="left_boundary_value" 
                                       value="{{ params.left_boundary_value if params.left_boundary_value is defined else 0 }}" step="0.1">
                                <span class="input-group-text" id="left_boundary_unit">u</span>
                            </div>
                            <small class="form-text text-muted">–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü–µ</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>–ü—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ (x = x_end):</label>
                            <select class="form-control mb-2" id="right_boundary_type" name="right_boundary_type">
                                <option value="dirichlet" {% if params.right_boundary_type == 'dirichlet' %}selected{% endif %}>–£—Å–ª–æ–≤–∏–µ –î–∏—Ä–∏—Ö–ª–µ (u = const)</option>
                                <option value="neumann" {% if params.right_boundary_type == 'neumann' %}selected{% endif %}>–£—Å–ª–æ–≤–∏–µ –ù–µ–π–º–∞–Ω–∞ (du/dx = const)</option>
                            </select>
                            <div class="input-group">
                                <input type="number" class="form-control" id="right_boundary_value" name="right_boundary_value" 
                                       value="{{ params.right_boundary_value if params.right_boundary_value is defined else 0 }}" step="0.1">
                                <span class="input-group-text" id="right_boundary_unit">u</span>
                            </div>
                            <small class="form-text text-muted">–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∞–≤–æ–π –≥—Ä–∞–Ω–∏—Ü–µ</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="parameters-group">
                <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ —Ä–µ—à–µ–Ω–∏—è</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="N">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–±–∏–µ–Ω–∏–π –æ—Ç—Ä–µ–∑–∫–∞ N:</label>
                            <input type="number" class="form-control" id="N" name="N" step="1" min="10" value="{{ params.N if params.N is defined else 100 }}" required>
                            <small class="form-text text-muted">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É</small>
                            <div class="info-text">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 100-500. –ü—Ä–∏ N=100 –±—É–¥–µ—Ç 101 —Ç–æ—á–∫–∞ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="cfl">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (CFL):</label>
                            <input type="number" class="form-control" id="cfl" name="cfl" step="0.1" min="0.1" max="1.0" value="{{ params.cfl if params.cfl is defined else '0.9' }}" required>
                            <small class="form-text text-muted">–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0 < CFL ‚â§ 1</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">–†–µ—à–∏—Ç—å —É—Ä–∞–≤–Ω–µ–Ω–∏–µ</button>
        </form>

        {% if animation_data %}
        <div class="animation-container" data-eq-name="{{ eq_name }}">
            <h3>–ê–Ω–∏–º–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è</h3>
            <div class="animation-controls mb-3">
                <button id="playPauseButton" class="btn btn-info me-2">‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
                <button id="resetButton" class="btn btn-info me-2">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                <div class="form-check d-inline-block">
                    <input class="form-check-input" type="checkbox" id="loopAnimation" checked>
                    <label class="form-check-label" for="loopAnimation">
                        –ó–∞—Ü–∏–∫–ª–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
                    </label>
                </div>
            </div>
            <div id="debug-info" style="margin: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 5px;">
                <small style="font-size: 0.8em;">–ö–∞–¥—Ä: <span id="current-frame-number">0</span> –∏–∑ <span id="total-frames">0</span></small>
            </div>
            <canvas id="animationCanvas" width="1200" height="600" style="width: 100%; height: auto;"></canvas>
            <div class="progress mt-2">
                <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
        </div>

        <script>
            (function() {
                const animationData = {
                    frameData: {{ animation_data.frame_data|tojson|safe }},
                    frameCount: {{ animation_data.frame_count }},
                    interval: {{ animation_data.interval }}
                };
                // –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø —É—Ä–∞–≤–Ω–µ–Ω–∏—è –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
                const eqName = document.querySelector('.animation-container').getAttribute('data-eq-name');
                let currentFrame = 0;
                let animationInterval = null;
                let isPlaying = false;
                const canvas = document.getElementById('animationCanvas');
                const ctx = canvas.getContext('2d');
                const playPauseButton = document.getElementById('playPauseButton');
                const resetButton = document.getElementById('resetButton');
                const progressBar = document.getElementById('progressBar');
                const currentFrameNumber = document.getElementById('current-frame-number');
                const totalFrames = document.getElementById('total-frames');
                totalFrames.textContent = animationData.frameCount;
                currentFrameNumber.textContent = '0';
                // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
                // –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–µ–π
                const paddingLeft = 100, paddingRight = 40, paddingTop = 80, paddingBottom = 60;
                function drawFrame(frameIndex) {
                    const frame = animationData.frameData[frameIndex];
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–µ–ª—ã –æ—Å–µ–π
                    let y_min, y_max;
                    if (eqName === 'wave') {
                        y_min = -1.2; y_max = 1.2;
                    } else if (eqName === 'advection') {
                        y_min = -0.2; y_max = 1.2;
                    } else {
                        y_min = 0.0; y_max = 1.2;
                    }
                    const x_min = frame.x[0];
                    const x_max = frame.x[frame.x.length-1];
                    // –°–µ—Ç–∫–∞ Y
                    ctx.strokeStyle = '#ddd';
                    ctx.lineWidth = 0.5;
                    for (let i = 0; i <= 10; i++) {
                        const y = y_min + (y_max - y_min) * i / 10;
                        const canvasY = canvas.height - paddingBottom - ((y - y_min) / (y_max - y_min)) * (canvas.height - paddingTop - paddingBottom);
                        ctx.beginPath();
                        ctx.moveTo(paddingLeft, canvasY);
                        ctx.lineTo(canvas.width - paddingRight, canvasY);
                        ctx.stroke();
                        ctx.fillStyle = '#000';
                        ctx.font = 'bold 22px Arial';
                        ctx.textAlign = 'right';
                        ctx.fillText(y.toFixed(2), paddingLeft - 5, canvasY + 8);
                    }
                    // –°–µ—Ç–∫–∞ X
                    for (let i = 0; i <= 10; i++) {
                        const x = x_min + (x_max - x_min) * i / 10;
                        const canvasX = paddingLeft + ((x - x_min) / (x_max - x_min)) * (canvas.width - paddingLeft - paddingRight);
                        ctx.beginPath();
                        ctx.moveTo(canvasX, paddingTop);
                        ctx.lineTo(canvasX, canvas.height - paddingBottom);
                        ctx.stroke();
                        ctx.fillStyle = '#000';
                        ctx.font = 'bold 22px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(x.toFixed(2), canvasX, canvas.height - paddingBottom + 28);
                    }
                    // –û—Å–∏
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(paddingLeft, canvas.height - paddingBottom);
                    ctx.lineTo(canvas.width - paddingRight, canvas.height - paddingBottom);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(paddingLeft, paddingTop);
                    ctx.lineTo(paddingLeft, canvas.height - paddingBottom);
                    ctx.stroke();
                    // –ü–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 28px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('x', canvas.width - paddingRight + 30, canvas.height - paddingBottom + 35);
                    ctx.textAlign = 'right';
                    ctx.fillText('u(x,t)', paddingLeft - 20, paddingTop - 20);
                    // –ì—Ä–∞—Ñ–∏–∫
                    ctx.strokeStyle = '#0066cc';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    for (let i = 0; i < frame.x.length; i++) {
                        const x = frame.x[i];
                        const y = frame.y[i];
                        const canvasX = paddingLeft + ((x - x_min) / (x_max - x_min)) * (canvas.width - paddingLeft - paddingRight);
                        const canvasY = canvas.height - paddingBottom - ((y - y_min) / (y_max - y_min)) * (canvas.height - paddingTop - paddingBottom);
                        if (i === 0) ctx.moveTo(canvasX, canvasY);
                        else ctx.lineTo(canvasX, canvasY);
                    }
                    ctx.stroke();
                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(frame.title, canvas.width / 2, paddingTop - 20);
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–¥—Ä–µ
                    currentFrameNumber.textContent = (frameIndex + 1).toString();
                    progressBar.style.width = (frameIndex / (animationData.frameCount - 1) * 100) + '%';
                }
                function updateFrame() {
                    if (currentFrame >= animationData.frameCount) {
                        if (document.getElementById('loopAnimation').checked) {
                            currentFrame = 0;
                        } else {
                            pause();
                            return;
                        }
                    }
                    drawFrame(currentFrame);
                    currentFrame++;
                }
                function togglePlayPause() {
                    if (isPlaying) {
                        pause();
                    } else {
                        play();
                    }
                }
                function play() {
                    if (!isPlaying) {
                        if (currentFrame >= animationData.frameCount) {
                            currentFrame = 0;
                        }
                        isPlaying = true;
                        playPauseButton.textContent = '‚è∏Ô∏è –ü–∞—É–∑–∞';
                        animationInterval = setInterval(updateFrame, animationData.interval);
                    }
                }
                function pause() {
                    if (isPlaying) {
                        isPlaying = false;
                        playPauseButton.textContent = '‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
                        if (animationInterval) {
                            clearInterval(animationInterval);
                            animationInterval = null;
                        }
                    }
                }
                function reset() {
                    pause();
                    currentFrame = 0;
                    drawFrame(0);
                }
                playPauseButton.addEventListener('click', togglePlayPause);
                resetButton.addEventListener('click', reset);
                drawFrame(0);
                play();
            })();
        </script>
        {% endif %}
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–æ—Ä–º—ã
        window.addEventListener('load', function() {
            console.log('–°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
            const initialConditionSelect = document.getElementById('initial_condition');
            const gaussianParams = document.getElementById('gaussian_params');
            const linearParams = document.getElementById('linear_params');

            if (initialConditionSelect && gaussianParams && linearParams) {
                console.log('–ù–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞—á–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π');
                initialConditionSelect.addEventListener('change', function() {
                    console.log('–ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞—á–∞–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:', this.value);
                    gaussianParams.style.display = this.value === 'gaussian' ? 'block' : 'none';
                    linearParams.style.display = this.value === 'linear' ? 'block' : 'none';
                });
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
            const leftBoundaryType = document.getElementById('left_boundary_type');
            const rightBoundaryType = document.getElementById('right_boundary_type');
            const leftBoundaryUnit = document.getElementById('left_boundary_unit');
            const rightBoundaryUnit = document.getElementById('right_boundary_unit');

            function updateBoundaryUnit(selectElement, unitElement) {
                if (selectElement && unitElement) {
                    const unit = selectElement.value === 'dirichlet' ? 'u' : 'du/dx';
                    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è:', unit);
                    unitElement.textContent = unit;
                }
            }

            if (leftBoundaryType && leftBoundaryUnit) {
                console.log('–ù–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã');
                leftBoundaryType.addEventListener('change', function() {
                    console.log('–ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã:', this.value);
                    updateBoundaryUnit(leftBoundaryType, leftBoundaryUnit);
                });
            }

            if (rightBoundaryType && rightBoundaryUnit) {
                console.log('–ù–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∞–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã');
                rightBoundaryType.addEventListener('change', function() {
                    console.log('–ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø –ø—Ä–∞–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã:', this.value);
                    updateBoundaryUnit(rightBoundaryType, rightBoundaryUnit);
                });
            }
        });
    </script>
</body>
</html>
